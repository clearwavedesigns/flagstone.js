/*
  FlagstoneJS v4.0.0
  (c) 2015-2018 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n,r){function a(n,r){function a(){for(var e=0,t=k.length;e<t;e++)Math.random()<q&&k.splice(e,0,!1)}function o(){L.style.visibility="hidden"}function s(){L.style.visibility="visible"}function i(){var t=[w],n=0,r=O.length;for(M=[];n<r;n++){if(n<w)k[n]?(k[n].style.transform="translate("+(A*n+(n?C*n+E:E))+"px,"+E+"px)",Z&&(k[n].style.height=k[n].style.width),t[n]=O[n]+E,ae(k[n],n),M.push([k[n]])):w>1&&(t[n]=A+E);else{var a=Math.min.apply(null,t),o=t.indexOf(a);k[n]?(k[n].style.transform="translate("+(A*o+(o?C*o+E:E))+"px,"+(a+C)+"px)",Z&&(k[n].style.height=k[n].style.width),t[o]+=O[n]+C,ae(k[n],n),M[o].push(k[n])):w>1&&(t[o]+=A+C)}b=(Math.max.apply(null,t)||O[0]+E)+E,L.style.height=b+"px"}e.setTimeout(s)}function l(t){if(k.length){y=L.offsetWidth,y<T+(E?2*E:0)&&(y=T),D=Math.floor(y/T),w=D>x?x:D,A=y/w-(C*(w-1)+2*E)/w,O=[];for(var n=0,r=k.length;n<r;n++)k[n]&&(k[n].style.width=A+"px",k[n].style.marginTop="0px"),O.push(Z||!k[n]?A:k[n].offsetHeight);y===L.offsetWidth||t?i():l(!0),t||e.setTimeout(function(){l(!0)},W)}}function g(t){if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var n=t.target;n&&!n.classList.contains(B);)n=n.parentElement;L.removeChild(n),e.MutationObserver||!oe&&!se||de()}}function d(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(l,Q)}function c(t){function n(){for(var t=0,n=M.length,r=0,a=0;t<n&&!g;t++)for(r=0,a=M[t].length;r<a;r++)g&&(i.push(M[t][r]),l.push(e.parseInt(M[t][r].style.marginTop,10)||0)),M[t][r]===o&&(g=!0)}function r(){for(var t=0,n=w,a=[];t<n;t++){var o=M[t][M[t].length-1],s=e.parseInt(o.style.transform.match(/\d+px/)[0],10)+(e.parseInt(o.style.marginTop,10)||0)+o.offsetHeight+E;a.push(s)}var i=Math.max.apply(null,a);L.style.height=i+"px",V=e[($?"request":"cancel")+"AnimationFrame"](r)}function a(){function t(){for(var r=o.offsetHeight+s,g=r-a,d=0;d<n;d++)i[d].style.marginTop=g+l[d]+"px";te=e[(ne?"request":"cancel")+"AnimationFrame"](t)}var n=i.length,a=e.parseInt(i[0].style.transform.match(/\d+px/)[0],10)-C+l[0];ne=!0,te=e.requestAnimationFrame(t),re=e.setTimeout(function(){ne=!1,e.cancelAnimationFrame(te)},U),$=!0,V=e.requestAnimationFrame(r),ee=e.setTimeout(function(){$=!1,e.cancelAnimationFrame(V)},U)}for(var o=t;o&&!o.classList.contains(B);)o=o.parentElement;var s=e.parseInt(o.style.transform.match(/\d+px/)[0],10)+(e.parseInt(o.style.marginTop,10)||0),i=[],l=[],g=!1;return n(),$=!1,e.cancelAnimationFrame(V),e.clearTimeout(ee),ne=!1,e.cancelAnimationFrame(te),e.clearTimeout(re),i.length?void a():($=!0,V=e.requestAnimationFrame(r),void(ee=e.setTimeout(function(){$=!1,e.cancelAnimationFrame(V)},U)))}function m(e){"keydown"===e.type&&13!==e.keyCode&&32!==e.keyCode||c(e.target)}function f(){e.clearTimeout(le),le=e.setTimeout(l,Y)}function v(){e.clearTimeout(ge),ge=e.setTimeout(de)}function u(){e.removeEventListener("resize",f),t.head.removeChild(t.getElementById("flagstone-"+S+"-styles"))}function h(e){e.margin||0===e.margin?(E=e.margin,C=e.margin):(E=e.bedPadding||E,C=e.stonesMargin||C),T=e.minWidth||T,x=e.maxColumns||x,G=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:G,K=e.dropCallback||K,ae=e.callback||ae,de()}var S=e.flagstone.index,p=r||{},L=n?"string"==typeof n?t.querySelector(n):n:t.getElementsByClassName("flagstone")[0],E=p.margin||0===p.margin?p.margin:p.bedPadding||0===p.bedPadding?p.bedPadding:10,y=0,b=0,T=p.minWidth||280,x=p.maxColumns||5,D=0,w=0,k=[],C=p.margin||0===p.margin?p.margin:p.stonesMargin||0===p.stonesMargin?p.stonesMargin:10,A=y/w-C*(w+1)/w,O=[],M=[],B="flagstone-"+S+"-bed__stone",F=p.flow,z=p.direction?p.direction.toLowerCase():"left",I=p.assignReverseZIndexes,P=p.random,q=p.spaceFrequency||.4,N=p.space,W=p.animationDuration||0,H=p.animationDuration/1e3,R=p.animationTimingFunction||"linear",_=p.heightAnimationDuration||0,X=p.heightAnimationDuration/1e3,j=p.heightAnimationTimingFunction||"linear",Y=p.resizeDelay||0===p.resizeDelay?p.resizeDelay:250,Z=p.square,G=p.dragAndDrop,J=p.dragAndDropAutoDelay,K=p.dropCallback||function(){return!0},Q=p.eventResetDelay||0,U=p.eventResizeHeightDuration||0,V=null,$=!1,ee=null,te=null,ne=!1,re=null,ae=p.callback||function(){},oe=p.watch!==!1,se=p.watchAll,ie=p.watchImages!==!1,le=null,ge=null,de=null,ce={targetElem:null,dragStone:null,targetStone:null,targetStoneOverLeft:0,autoDropTimer:null,autoDrop:function(){ce.targetStone&&ce.targetStone.classList.contains(B)&&(ce.targetStoneOverLeft?ce.dragStone!==ce.targetStone.previousElementSibling&&(ce.targetStone.parentElement.insertBefore(ce.dragStone,ce.targetStone),ce.targetStone.classList.remove("flagstone-left"),ce.targetStone.classList.remove("flagstone-dragover")):ce.dragStone!==ce.targetStone.nextElementSibling&&(ce.targetStone.parentElement.insertBefore(ce.dragStone,ce.targetStone.nextElementSibling),ce.targetStone.classList.remove("flagstone-right"),ce.targetStone.classList.remove("flagstone-dragover")),e.clearTimeout(ce.autoDropTimer),ce.autoDropTimer=e.setTimeout(ce.autoDrop,J))},clear:function(){ce.dragStone&&(ce.dragStone.classList.remove("flagstone-drag"),ce.dragStone=null),ce.targetStone&&(ce.targetStoneOverLeft=0,ce.targetStone.classList.remove("flagstone-dragover"),ce.targetStone.classList.remove("flagstone-left"),ce.targetStone.classList.remove("flagstone-right"),ce.targetStone=null),L.classList.remove("flagstone-dragover")},getTargetElem:function(e){for(ce.targetElem=e.target instanceof HTMLElement?e.target:e.target.parentElement;ce.targetElem&&!ce.targetElem.classList.contains("flagstone-drag-handle");)ce.targetElem=ce.targetElem.parentElement;if(ce.targetElem)for(ce.dragStone=ce.targetElem;ce.dragStone&&!ce.dragStone.classList.contains(B);)ce.dragStone=ce.dragStone.parentElement},mouseDown:function(e){ce.getTargetElem(e)},dragStart:function(e){return!!ce.targetElem&&(ce.dragStone.classList.add("flagstone-drag"),void(e.dataTransfer&&e.dataTransfer.setData("text",this.id)))},touchStart:function(e){ce.getTargetElem(e),ce.dragStart(e)},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==ce.dragStone&&this!==ce.targetStone&&this!==L&&(e.clearTimeout(ce.autoDropTimer),ce.autoDropTimer=e.setTimeout(ce.autoDrop,J))},touchMove:function(e){if(!ce.dragStone)return!1;e.preventDefault(),e.stopPropagation();for(var n=t.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY),r=n;r&&!r.classList.contains(B);)r=r.parentElement;r?(L.classList.remove("flagstone-dragover"),ce.targetStoneOverLeft=r.getBoundingClientRect().left+r.offsetWidth/2>e.touches[0].clientX,ce.targetStone&&ce.targetStone!==r&&(ce.targetStone.classList.remove("flagstone-dragover"),ce.targetStone.classList.remove("flagstone-left"),ce.targetStone.classList.remove("flagstone-right")),ce.targetStone=r,ce.targetStone.classList.contains("flagstone-lock")||(ce.targetStone.classList.add("flagstone-dragover"),ce.targetStoneOverLeft?(ce.targetStone.classList.remove("flagstone-right"),ce.targetStone.classList.add("flagstone-left")):(ce.targetStone.classList.remove("flagstone-left"),ce.targetStone.classList.add("flagstone-right")))):n===L&&(ce.targetStone.classList.remove("flagstone-dragover"),ce.targetStone.classList.remove("flagstone-left"),ce.targetStone.classList.remove("flagstone-right"),L.classList.add("flagstone-dragover"),ce.targetStone=L)},dragOver:function(e){return!!ce.dragStone&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",void(this!==ce.dragStone&&this.classList.contains(B)?(ce.targetStone=this,ce.targetStone.classList.add("flagstone-dragover"),ce.targetStoneOverLeft=this.getBoundingClientRect().left+this.offsetWidth/2>e.clientX,ce.targetStoneOverLeft?(ce.targetStone.classList.remove("flagstone-right"),ce.targetStone.classList.add("flagstone-left")):(ce.targetStone.classList.remove("flagstone-left"),ce.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover"),ce.targetStone!==L&&L.classList.remove("flagstone-dragover")):this===L&&this.classList.add("flagstone-dragover")))},dragEnd:function(){ce.clear()},touchEnd:function(){ce.dragStone&&ce.targetStone&&!ce.targetStone.classList.contains("flagstone-lock")&&K(ce.dropStone,ce.targetStone)&&(ce.targetStone===L?L.appendChild(ce.dragStone):ce.targetStoneOverLeft?L.insertBefore(ce.dragStone,ce.targetStone):L.insertBefore(ce.dragStone,ce.targetStone.nextElementSibling)),ce.clear()},dragLeave:function(){ce.targetStone&&(ce.targetStone.classList.remove("flagstone-dragover"),ce.targetStone.classList.remove("flagstone-left"),ce.targetStone.classList.remove("flagstone-right"),L.classList.remove("flagstone-dragover"))},drop:function(t){if(!ce.dragStone)return!1;if(t.stopPropagation(),e.clearTimeout(ce.autoDropTimer),ce.dragStone!==this&&(this.classList.contains(B)||this===L)){if(ce.targetStone=this,ce.targetStone===L){if(!K(ce.dragStone,ce.targetStone))return ce.clear(),!1;ce.targetStone.appendChild(ce.dragStone)}else if(ce.targetStoneOverLeft){if(!K(ce.dragStone,ce.targetStone))return ce.clear(),!1;ce.targetStone.parentElement.insertBefore(ce.dragStone,ce.targetStone)}else{if(!K(ce.dragStone,ce.targetStone.nextElementSibling))return ce.clear(),!1;ce.targetStone.parentElement.insertBefore(ce.dragStone,ce.targetStone.nextElementSibling)}ce.clear(),e.MutationObserver||!oe&&!se||de()}return!1}};return de=function(){k=Array.prototype.slice.call(L.children);for(var t=0,n=k.length;t<n;t++)k[t].classList.add(B),I&&(k[t].style.zIndex=n-t);if(ie)for(var r=L.getElementsByTagName("img"),o=0,s=r.length;o<s;o++)r[o].naturalWidth||(r[o].removeEventListener("load",l),r[o].addEventListener("load",l),r[o].removeEventListener("error",l),r[o].addEventListener("error",l));for(t=0;t<n;t++)k[t].removeAttribute("draggable"),k[t].removeEventListener("mousedown",ce.mouseDown),k[t].removeEventListener("dragstart",ce.dragStart),k[t].removeEventListener("touchstart",ce.touchStart),k[t].removeEventListener("touchmove",ce.touchMove),k[t].removeEventListener("dragover",ce.dragOver),k[t].removeEventListener("dragleave",ce.dragLeave),k[t].removeEventListener("dragend",ce.dragEnd),k[t].removeEventListener("touchend",ce.touchEnd),k[t].removeEventListener("drop",ce.drop),k[t].removeEventListener("touchend",ce.drop),k[t].removeEventListener("dragenter",ce.dragEnter);if(L.removeEventListener("dragover",ce.dragOver),L.removeEventListener("drop",ce.drop),G){for(t=0;t<n;t++)k[t].classList.contains("flagstone-lock")||(k[t].setAttribute("draggable","true"),k[t].addEventListener("mousedown",ce.mouseDown),k[t].addEventListener("dragstart",ce.dragStart),k[t].addEventListener("touchstart",ce.touchStart),k[t].addEventListener("touchmove",ce.touchMove),k[t].addEventListener("dragover",ce.dragOver),k[t].addEventListener("dragleave",ce.dragLeave),k[t].addEventListener("dragend",ce.dragEnd),k[t].addEventListener("touchend",ce.touchEnd),k[t].addEventListener("drop",ce.drop),k[t].addEventListener("touchend",ce.drop),J&&k[t].addEventListener("dragenter",ce.dragEnter),k[t].getElementsByClassName("flagstone-drag-handle").length||k[t].classList.add("flagstone-drag-handle"));L.addEventListener("dragover",ce.dragOver),L.addEventListener("drop",ce.drop)}(P||N)&&(P&&k.sort(function(){return.5-Math.random()}),N&&a());var i=L.getElementsByClassName("flagstone-remove");for(t=0,n=i.length;t<n;t++)i[t].removeEventListener("click",g),i[t].addEventListener("click",g),i[t].removeEventListener("keydown",g),i[t].addEventListener("keydown",g);for(i=L.getElementsByClassName("flagstone-reset"),t=0,n=i.length;t<n;t++)i[t].removeEventListener("click",d),i[t].addEventListener("click",d),i[t].removeEventListener("keydown",d),i[t].addEventListener("keydown",d);for(i=L.getElementsByClassName("flagstone-resize-height"),t=0,n=i.length;t<n;t++)i[t].removeEventListener("click",m),i[t].addEventListener("click",m),i[t].removeEventListener("keydown",m),i[t].addEventListener("keydown",m);l(),e.setTimeout(function(){l(!0)},W)},function(){if(o(),L.classList.add("flagstone-"+S+"-bed"),!t.getElementById("flagstone-"+S+"-styles")){var n=".flagstone-"+S+"-bed{box-sizing:border-box;list-style-type:none;overflow:hidden;position:relative;min-width:"+(T+2*E)+"px;}",r=".flagstone-"+S+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+z+":0px;margin:0;}",a=".flagstone-"+S+"-bed__stone{transition:transform "+H+"s "+R+(F?",width "+H+"s "+R:"")+(_?",height "+X+"s "+j:"")+";}",s=n+r+a,i=t.createElement("style");i.type="text/css",i.id="flagstone-"+S+"-styles",i.appendChild(t.createTextNode(s)),t.head.appendChild(i)}if(de(),e.removeEventListener("resize",f),e.addEventListener("resize",f),e.MutationObserver&&(oe||se)){var l=new e.MutationObserver(v);se&&ie?l.observe(L,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src"]}):l.observe(L,{childList:!0,subtree:se})}}(),{adjust:h,destroy:u,resizeHeight:c,hide:o,reset:f,hardReset:de}}return e.flagstone.index++,new a(n,r)},e.flagstone.index=-1}(window,document);
